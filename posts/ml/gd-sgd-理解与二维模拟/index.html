<!DOCTYPE html>
<html >
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="author" content="XFeiF">
		<meta name="description" content="XFeiFçš„ç‹¬ç«‹åšå®¢">
		<meta name="generator" content="Hugo 0.69.2" />
		<title>GD &amp; SGD ç†è§£ä¸äºŒç»´æ¨¡æ‹Ÿ &middot; </title>
		<link rel="shortcut icon" href="https://blog.x-fei.me/images/favicon.ico">
		<link rel="stylesheet" href="https://blog.x-fei.me/css/style.css">
		
		
		
		

		

		
		<link href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<link href="https://cdn.staticfile.org/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<script src="https://cdn.staticfile.org/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>
<script type="text/javascript" async src="https://cdn.staticfile.org/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [
                ['$', '$'],
                ['\\(', '\\)']
            ],
            displayMath: [
                ['$$', '$$'],
                ['\[\[', '\]\]']
            ],
            processEscapes: true,
            processEnvironments: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
            TeX: {
                equationNumbers: {
                    autoNumber: "AMS"
                },
                extensions: ["AMSmath.js", "AMSsymbols.js"]
            }
        }
    });

    MathJax.Hub.Queue(function() {
        
        
        
        var all = MathJax.Hub.getAllJax(),
            i;
        for (i = 0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
    MathJax.Hub.Config({
        CommonHTML: {
            linebreaks: {
                automatic: true
            }
        },
        "HTML-CSS": {
            linebreaks: {
                automatic: true
            }
        },
        SVG: {
            linebreaks: {
                automatic: true
            }
        }
    });
</script>

<style>
    code.has-jax {
        font: inherit;
        font-size: 100%;
        background: inherit;
        border: inherit;
        color: #515151;
    }
</style>


<script src="https://cdn.staticfile.org/jquery/1.8.3/jquery.js"></script>
<script src="https://cdn.staticfile.org/jquery.imagesloaded/2.1.0/jquery.imagesloaded.js"></script>
<script src="https://cdn.staticfile.org/masonry/4.2.2/masonry.pkgd.min.js"></script>
<script src="https://cdn.staticfile.org/bigfoot/2.1.4/bigfoot.min.js"></script>
<link href="https://cdn.staticfile.org/bigfoot/2.1.4/bigfoot-default.min.css" rel="stylesheet">
	</head>


<body>
    <div class="nav-header nav-header-fixed animated">
    <a href="https://blog.x-fei.me/" class="left swing">
        <img src="https://blog.x-fei.me/images/Feiaaa.png" alt="" class="icon rounded">
    </a>
</div>

 
<header id="header" class="blog-background banner-mask lazy no-cover" style="display: table; background-image: url(https://raw.githubusercontent.com/XFeiF/Photos/master/blog/sgd_bg.jpg);">
    <div class="header-wrap site-nav">
    <div class="home-info-container">
        <a href="https://blog.x-fei.me/">
            <h2>Do not go gentle into that good night</h2>
        </a>
    </div>
    <div class="nav-header-container">
        <ul class="links">
            <li class="nav-blog">
                <a href='https://blog.x-fei.me/'> Home</a>
            </li>
            <li>
                <a href='https://blog.x-fei.me/archives'>Archives</a>
            </li>
            <li>
                <a href='https://blog.x-fei.me/timelines'>Timelines</a>
            </li>
            <li>
                <a href='https://blog.x-fei.me/friends'>Friends</a>
            </li>
            <li>
                <a href='https://blog.x-fei.me/about'>About</a>
            </li>
        </ul>


    	

    	
    </div>
</div>

</header>
 
    <div id="main">
        <article class="page-template page-index container-wrapper">
            <div class="post-card">
                <div class="post-container">
                    <div class="post-header">
                        <div class="meta">
                            <h1 id="post-title">GD &amp; SGD ç†è§£ä¸äºŒç»´æ¨¡æ‹Ÿ</h1>
                            
                            
                                <time datetime="2018-10-10">Oct 10, 2018</time>
                            
                            <span class="categories">
                                 on 
    
        <a class="badge badge-primary" href="/categories/machine-learning">Machine Learning</a>
    


                            </span> - 4 min read.

                        </div>
                    </div>
                    <div class="post-content">
                        <div id="toc" class="">

                        </div>
                        <div class="inner-content">
                            <p><strong><center>Machine Learning Exercise 2</center></strong></p>

<h3 id="å®éªŒé¢˜ç›®">å®éªŒé¢˜ç›®</h3>

<ol>
<li>Generate n = 2,000 points uniformly at random in the two-dimensional unit square. Which point do you expect the centroid to be?<br /></li>
<li>What objective does the centroid of the points optimize?<br /></li>
<li>Apply gradient descent (GD) to find the centroid.<br /></li>
<li>Apply stochastic gradient descent (SGD) to find the centroid. Can you
say in simple words, what the algorithm is doing?<br /></li>
</ol>

<h3 id="å®éªŒè¦æ±‚">å®éªŒè¦æ±‚</h3>

<p>1)ç¼–ç¨‹è¯­è¨€ä¸é™ã€‚<br />
2)ä½œä¸šåŒ…å«ä¸€ä»½æŠ¥å‘Š(word æˆ– pdf æ ¼å¼)åŠä»£ç åŠ æ³¨é‡Šï¼Œå¹¶æ‰“åŒ…åˆ°.zipï¼Œå…¶ä¸­ zip æ–‡ä»¶çš„å‘½åæ ¼å¼ä¸ºå­¦å·_å§“åã€‚<br />
3)ä¸å…è®¸ä½¿ç”¨æ¢¯åº¦ä¸‹é™ç›¸å…³çš„åº“å‡½æ•°ã€‚<br />
4)ç¦æ­¢æŠ„è¢­ã€‚</p>

<h3 id="å®éªŒè¿‡ç¨‹åŠä»£ç ">å®éªŒè¿‡ç¨‹åŠä»£ç </h3>

<h4 id="q1">Q1</h4>

<p><strong>Generate n = 2,000 points uniformly at random in the two-dimensional unit square. Which point do you expect the centroid to be?</strong><br />
åœ¨æ•°å­¦å’Œç‰©ç†å­¦ä¸­ï¼Œå¹³é¢å›¾å½¢çš„è´¨å¿ƒæˆ–å‡ ä½•ä¸­å¿ƒæ˜¯å›¾ä¸­æ‰€æœ‰ç‚¹çš„ç®—æœ¯å¹³å‡å€¼ï¼›åœ¨å‡ ä½•å­¦ä¸­ï¼Œé‡å¿ƒæ—¶è´¨å¿ƒçš„åŒä¹‰è¯ï¼›åœ¨å¤©ä½“ç‰©ç†å­¦å’Œå¤©æ–‡å­¦ä¸­ï¼Œé‡å¿ƒæ˜¯ä¸¤ä¸ªæˆ–å¤šä¸ªè½¨é“ç›¸äº’ç¯ç»•çš„ç‰©è´¨çš„è´¨å¿ƒã€‚å¦‚æœç‰©ç†å¯¹è±¡å…·æœ‰å‡åŒ€çš„å¯†åº¦ï¼Œåˆ™å…¶è´¨å¿ƒä¸å…¶å½¢çŠ¶çš„è´¨å¿ƒç›¸åŒã€‚<br />
é¦–å…ˆç”Ÿæˆ2000ä¸ªåˆ†å¸ƒåœ¨0~1èŒƒå›´ä¹‹é—´çš„éšæœºæ•£ç‚¹ï¼Œä»ç»Ÿè®¡å­¦çš„è§’åº¦ç†è§£ï¼Œå®ƒä»¬å…·æœ‰å‡åŒ€çš„å¯†åº¦ï¼Œè´¨å¿ƒæ˜¯æœ€èƒ½ä»£è¡¨è¿™ç¾¤ç‚¹çš„ç‚¹ï¼Œå®ƒåˆ°æ‰€æœ‰ç‚¹è·ç¦»ä¹‹å’Œæœ€å°ã€‚ç”±äºç‚¹çš„ç”Ÿæˆæ˜¯éšæœºçš„ï¼Œæ‰€ä»¥æœŸæœ›çš„ç‚¹æ˜¯<code>(0.5, 0.5)</code>ã€‚</p>

<p>æˆ‘ä»¬åˆ©ç”¨å¦‚ä¸‹çš„ä»£ç ç”Ÿæˆ2000ä¸ªåˆ†å¸ƒåœ¨0~1èŒƒå›´ä¹‹é—´çš„éšæœºæ•£ç‚¹ï¼Œç”¨è“è‰²ç‚¹æ ‡å‡ºï¼ŒåŒæ—¶ç”¨çº¢ç‚¹æ ‡æ³¨æˆ‘ä»¬æœŸæœ›çš„è´¨å¿ƒã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt  

Sample_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">2000</span>
x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>random_sample((Sample_num, ))
y <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>random_sample((Sample_num, ))

plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">8</span>))
plt<span style="color:#f92672">.</span>plot(x, y, <span style="color:#e6db74">&#39;b.&#39;</span>)
plt<span style="color:#f92672">.</span>plot(<span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0.5</span>, <span style="color:#e6db74">&#39;ro&#39;</span>)</code></pre></div>
<div align=center>
<img src="/images/hw2_points.png" width="60%" alt="Sample">
</div>   

<h4 id="q2">Q2</h4>

<p><strong>What objective does the centroid of the points optimize?</strong><br />
åœ¨*Q1*ä¸­æˆ‘ä»¬åˆ†æå¾—åˆ°ï¼Œè´¨å¿ƒæ˜¯ä¸€ç¾¤ç‚¹ä¸­åˆ°å…¶ä»–æ‰€æœ‰ç‚¹è·ç¦»å’Œæœ€å°çš„ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯æœ€å°åŒ–è·ç¦»ä¹‹å’Œã€‚<br />
å‡è®¾å½“å‰ç‚¹ä¸º:<code>C(x,y)</code>ï¼Œä¸å…¶ä»–æ‰€æœ‰ç‚¹çš„è·ç¦»ä¸º<code>dist(x,y)</code>ã€‚æ‰€ä»¥ä¼˜åŒ–çš„ç›®æ ‡æ˜¯ï¼š<br />
<div align=center>
<img src="/images/dist_func.png" width="60%" alt="optimize_func">
</div></p>

<p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥å®šä¹‰æŸå¤±å‡½æ•°å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">cost</span>(c, points):
    <span style="color:#e6db74">&#39;&#39;&#39;
</span><span style="color:#e6db74">    params:
</span><span style="color:#e6db74">      c: (x,y) è¡¨ç¤ºå¾…æ±‚çš„è´¨å¿ƒåæ ‡
</span><span style="color:#e6db74">      points: æ‰€æœ‰çš„ç‚¹
</span><span style="color:#e6db74">    return:
</span><span style="color:#e6db74">      dist: cåˆ°æ‰€æœ‰ç‚¹çš„è·ç¦»ä¹‹å’Œ
</span><span style="color:#e6db74">    &#39;&#39;&#39;</span>
    <span style="color:#66d9ef">return</span> sum(sum((c <span style="color:#f92672">-</span> points) <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span>, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">**</span> <span style="color:#ae81ff">0.5</span>)</code></pre></div>
<h4 id="q3">Q3</h4>

<p><strong>Apply gradient descent (GD) to find the centroid.</strong></p>

<h5 id="æŸå¤±å‡½æ•°">æŸå¤±å‡½æ•°</h5>

<p>æ ¹æ®æŸå¤±å‡½æ•°<code>cost</code>ï¼Œæ±‚å‡ºå…¶åœ¨å½“å‰ç‚¹<code>(x, y)</code>ä¸¤ä¸ªç»´åº¦ä¸Šçš„æ¢¯åº¦<code>(dx, dy)</code>ï¼Œæ¢¯åº¦æ±‚è§£çš„å…¬å¼å¦‚ä¸‹ï¼š<br />
<div align=center>
<img src="/images/grad_dist.png" width="60%" alt="grad">
</div></p>

<p>å…¶ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gradient_raw</span>(c, points):
    <span style="color:#e6db74">&#39;&#39;&#39;
</span><span style="color:#e6db74">    params:
</span><span style="color:#e6db74">      c: (x,y) è¡¨ç¤ºå¾…æ±‚çš„è´¨å¿ƒåæ ‡
</span><span style="color:#e6db74">      points: æ‰€æœ‰çš„ç‚¹
</span><span style="color:#e6db74">    return:
</span><span style="color:#e6db74">      (dx, dy), åœ¨cç‚¹æ—¶coståœ¨ä¸¤ä¸ªç»´åº¦æ–¹å‘çš„æ¢¯åº¦
</span><span style="color:#e6db74">    &#39;&#39;&#39;</span>
    x <span style="color:#f92672">=</span> points[:, <span style="color:#ae81ff">0</span>]
    y <span style="color:#f92672">=</span> points[:, <span style="color:#ae81ff">1</span>]
    dist <span style="color:#f92672">=</span> sum((c <span style="color:#f92672">-</span> points) <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span>, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">**</span> <span style="color:#ae81ff">0.5</span>
    dx <span style="color:#f92672">=</span> sum((c[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> x) <span style="color:#f92672">/</span> dist)  <span style="color:#75715e">#æ±‚xåå¯¼æ•°</span>
    dy <span style="color:#f92672">=</span> sum((c[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> y) <span style="color:#f92672">/</span> dist)  <span style="color:#75715e">#æ±‚yåå¯¼æ•°</span>
    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>asarray([dx, dy])</code></pre></div>
<h5 id="gd">GD</h5>

<p>è¿™ä¸€æ­¥è®¾ç½®ä¸€äº›å‚æ•°ï¼Œç¼–å†™å¥½æ¢¯åº¦ä¸‹é™å‡½æ•°ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gradientDescent_raw</span>(points, start<span style="color:#f92672">=</span>array([<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>]), theta<span style="color:#f92672">=</span><span style="color:#ae81ff">0.01</span>, iterations<span style="color:#f92672">=</span><span style="color:#ae81ff">500</span>, eps<span style="color:#f92672">=</span><span style="color:#ae81ff">1e-6</span>):
    <span style="color:#e6db74">&#39;&#39;&#39;
</span><span style="color:#e6db74">    params:
</span><span style="color:#e6db74">      start: åˆå§‹åŒ–ç‚¹ï¼Œå³å‡ºå‘ç‚¹ï¼Œä¸ºäº†ä¾¿äºè§‚å¯Ÿï¼Œå¯ä»¥è®¾ç½®ä¸ºå››ä¸ªé¡¶ç‚¹ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œè¿™é‡Œé»˜è®¤ä¸ºå³ä¸Šè§’çš„é¡¶ç‚¹
</span><span style="color:#e6db74">      points: æ‰€æœ‰é‡‡æ ·ç‚¹
</span><span style="color:#e6db74">      theta: æ­¥é•¿ï¼Œå³å­¦ä¹ ç‡ï¼Œæ§åˆ¶æ­¥é•¿
</span><span style="color:#e6db74">      iterations: è¿­ä»£æ¬¡æ•°
</span><span style="color:#e6db74">      eps: é˜ˆå€¼ï¼Œé€šè¿‡æ¯”è¾ƒå‰åè¿ç»­ä¸¤æ¬¡çš„costå·®å€¼æ§åˆ¶è¿­ä»£ã€‚
</span><span style="color:#e6db74">    return:
</span><span style="color:#e6db74">      x_route: centroidè·¯å¾„
</span><span style="color:#e6db74">      x: æ”¶æ•›æ—¶çš„centroid
</span><span style="color:#e6db74">      i: end iteration, é€€å‡ºè¿­ä»£æ—¶å·²ç»è¿­ä»£äº†å¤šå°‘æ¬¡
</span><span style="color:#e6db74">    &#39;&#39;&#39;</span>
    x <span style="color:#f92672">=</span> start
    x_route <span style="color:#f92672">=</span> x
    pre_cost <span style="color:#f92672">=</span> cost(x, points) <span style="color:#75715e"># åˆå§‹cost</span>
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(iterations):
        grad <span style="color:#f92672">=</span> gradient(x, points)
        x_i <span style="color:#f92672">=</span> x <span style="color:#f92672">-</span> theta <span style="color:#f92672">*</span> grad
        cur_cost <span style="color:#f92672">=</span> cost(x_i, points)
        <span style="color:#66d9ef">if</span> abs(pre_cost <span style="color:#f92672">-</span> cur_cost) <span style="color:#f92672">&gt;</span> eps: <span style="color:#75715e"># å‰ä¸€ä¸ªcostä¸å½“å‰costçš„å·®å¤§äºé˜ˆå€¼ï¼Œå¯ä»¥ç»§ç»­è¿­ä»£</span>
            x <span style="color:#f92672">=</span> x_i
            pre_cost <span style="color:#f92672">=</span> cur_cost
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">return</span> x_route, x, i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>
        x_route <span style="color:#f92672">=</span> vstack((x_route, x))
    <span style="color:#66d9ef">return</span> x_route, x, i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span></code></pre></div>
<h5 id="ç»“æœç»˜å›¾ä¸åˆ†æ">ç»“æœç»˜å›¾ä¸åˆ†æ</h5>

<p>ç¼–å†™è¾…åŠ©å‡½æ•°ä¸æµ‹è¯•å‡½æ•°ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">plotRoute</span>(points, route, c, endIteration):
    plt<span style="color:#f92672">.</span>plot(points[:, <span style="color:#ae81ff">0</span>], points[:, <span style="color:#ae81ff">1</span>], <span style="color:#e6db74">&#39;b,&#39;</span>)
    plt<span style="color:#f92672">.</span>plot(route[:, <span style="color:#ae81ff">0</span>], route[:, <span style="color:#ae81ff">1</span>], <span style="color:#e6db74">&#39;r.&#39;</span>)
    plt<span style="color:#f92672">.</span>plot(route[:, <span style="color:#ae81ff">0</span>], route[:, <span style="color:#ae81ff">1</span>], <span style="color:#e6db74">&#39;k-&#39;</span>)
    plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;c = (</span><span style="color:#e6db74">%.3f</span><span style="color:#e6db74">, </span><span style="color:#e6db74">%.3f</span><span style="color:#e6db74">), endAt = </span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> (c[<span style="color:#ae81ff">0</span>], c[<span style="color:#ae81ff">1</span>], endIteration))
    <span style="color:#66d9ef">print</span>(c)
    plt<span style="color:#f92672">.</span>show()

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">test</span>():
    x_b, c, i <span style="color:#f92672">=</span> gradientDescent(points, theta<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span>,, iterations<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span>, lr_decay<span style="color:#f92672">=</span><span style="color:#ae81ff">0.8</span>)
    plotRoute(points, x_b, c, i)</code></pre></div>
<p>è¿è¡Œä¸Šé¢çš„ç¨‹åºå¹¶ç»˜å›¾ã€‚
<div align=center>
<img src="/images/gd_2errors.png" width="60%" alt="Error1">
</div></p>

<p>ç»“æœåˆ†æï¼š</p>

<p><strong>é—®é¢˜1ï¼šä¸æ”¶æ•›</strong>
å›¾ç¤ºè·¯å¾„ä¸æœ€ç»ˆå¾—åˆ°çš„<code>centroid(x,y)</code>è¡¨æ˜è¾¾åˆ°<strong>æœ€å¤§è¿­ä»£æ¬¡æ•°åï¼Œæ²¡æœ‰æ”¶æ•›</strong>ï¼Œå°è¯•äº†å¢å¤§è¿­ä»£æ¬¡æ•°åˆ°10000ï¼Œ100000ä¹‹åä¾ç„¶å¾—åˆ°çš„æ˜¯ç±»ä¼¼çš„ç»“æœã€‚<br />
è§‚å¯Ÿå‘ç°è·¯å¾„ä¸æ˜¯ä¸€ç‚¹ä¸€ç‚¹æ…¢æ…¢å‘ä¸­å¿ƒé æ‹¢ï¼Œè€Œæ˜¯åœ¨ä¸¤è¾¹å¾ˆå¤¸å¼ åœ°è·³è·ƒï¼Œå› æ­¤é—®é¢˜å‡ºåœ¨thetaï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„å­¦ä¹ ç‡ä¸Šã€‚å½“æŸä¸€æ­¥â€œè·¨â€çš„è¿‡å¤§ï¼Œå³æœ¬æ¬¡è¿­ä»£æ›´æ–°åçš„<code>cur_cost</code>æ¯”<code>pre_cost</code>è¦å¤§çš„æ—¶å€™ï¼Œè¯´æ˜æˆ‘ä»¬ä¸æ˜¯æœç€ä¸‹é™çš„æ–¹å‘åœ¨èµ°ï¼Œæ­¤æ—¶è¦è°ƒæ•´æˆ‘ä»¬çš„æ­¥ä¼ï¼Œè¿ˆå°ä¸€ç‚¹çš„æ­¥å­ã€‚å› æ­¤æˆ‘ä»¬æ›´æ–°æˆ‘ä»¬çš„æ¢¯åº¦ä¸‹é™å‡½æ•°å¦‚ä¸‹ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gradientDescent</span>(points, start<span style="color:#f92672">=</span>array([<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>]), theta<span style="color:#f92672">=</span><span style="color:#ae81ff">0.01</span>, iterations<span style="color:#f92672">=</span><span style="color:#ae81ff">500</span>, eps<span style="color:#f92672">=</span><span style="color:#ae81ff">1e-6</span>, lr_decay<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>):
    <span style="color:#e6db74">&#39;&#39;&#39;
</span><span style="color:#e6db74">    params:
</span><span style="color:#e6db74">      start: åˆå§‹åŒ–ç‚¹ï¼Œå³å‡ºå‘ç‚¹ï¼Œä¸ºäº†ä¾¿äºè§‚å¯Ÿï¼Œå¯ä»¥è®¾ç½®ä¸ºå››ä¸ªé¡¶ç‚¹ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œè¿™é‡Œé»˜è®¤ä¸ºå³ä¸Šè§’çš„é¡¶ç‚¹
</span><span style="color:#e6db74">      points: æ‰€æœ‰é‡‡æ ·ç‚¹
</span><span style="color:#e6db74">      theta: æ­¥é•¿ï¼Œå³å­¦ä¹ ç‡ï¼Œæ§åˆ¶æ­¥é•¿
</span><span style="color:#e6db74">      iterations: è¿­ä»£æ¬¡æ•°
</span><span style="color:#e6db74">      eps: é˜ˆå€¼ï¼Œé€šè¿‡æ¯”è¾ƒå‰åè¿ç»­ä¸¤æ¬¡çš„costå·®å€¼æ§åˆ¶è¿­ä»£
</span><span style="color:#e6db74">      lr_decay: æ­¥é•¿è¡°å‡æ¯”ä¾‹
</span><span style="color:#e6db74">    return:
</span><span style="color:#e6db74">      x_route: centroidè·¯å¾„
</span><span style="color:#e6db74">      x: æ”¶æ•›æ—¶çš„centroid
</span><span style="color:#e6db74">      i: end iteration, é€€å‡ºè¿­ä»£æ—¶å·²ç»è¿­ä»£äº†å¤šå°‘æ¬¡
</span><span style="color:#e6db74">    &#39;&#39;&#39;</span>
    x <span style="color:#f92672">=</span> start
    x_route <span style="color:#f92672">=</span> x
    pre_cost <span style="color:#f92672">=</span> cost(x, points) <span style="color:#75715e"># åˆå§‹cost</span>
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(iterations):
        grad <span style="color:#f92672">=</span> gradient(x, points)
        x_i <span style="color:#f92672">=</span> x <span style="color:#f92672">-</span> theta <span style="color:#f92672">*</span> grad
        cur_cost <span style="color:#f92672">=</span> cost(x_i, points)
        <span style="color:#66d9ef">if</span> pre_cost <span style="color:#f92672">-</span> cur_cost <span style="color:#f92672">&gt;</span> eps: <span style="color:#75715e"># å‰ä¸€ä¸ªcostä¸å½“å‰costçš„å·®å¤§äºé˜ˆå€¼ï¼Œå¯ä»¥ç»§ç»­è¿­ä»£</span>
            x <span style="color:#f92672">=</span> x_i
            pre_cost <span style="color:#f92672">=</span> cur_cost
        <span style="color:#66d9ef">elif</span> cur_cost <span style="color:#f92672">-</span> pre_cost <span style="color:#f92672">&gt;</span> eps: <span style="color:#75715e"># è¿™ä¸€æ­¥â€œè·¨â€çš„è¿‡å¤§ï¼Œè°ƒå°æ­¥é•¿</span>
            theta <span style="color:#f92672">=</span> theta <span style="color:#f92672">*</span> lr_decay
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">return</span> x_route, x, i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>
        x_route <span style="color:#f92672">=</span> vstack((x_route, x))
    <span style="color:#66d9ef">return</span> x_route, x, i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span></code></pre></div>
<p>å†æ¬¡è¿è¡Œç»“æœç»˜å›¾ã€‚<br />
<div align=center>
<img src="/images/hw2_error1.png" width="60%" alt="Error2">
</div></p>

<p>å‡ºç°æ–°çš„é—®é¢˜ã€‚
<strong>é—®é¢˜2:ç¬¬ä¸€æ­¥ç›´æ¥â€œè·¨â€åˆ°ä¸­å¿ƒä½ç½®é™„è¿‘</strong>
åœ¨<code>gradient_raw</code>å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¾—åˆ°çš„æ¢¯åº¦ä¸ä»…åŒ…å«æ–¹å‘ï¼Œä¹ŸåŒ…å«äº†åœ¨è¯¥æ–¹å‘ä¸Šçš„é•¿åº¦ï¼Œè¿™ä¸ªé•¿åº¦æ•°å€¼å¯èƒ½è¾ƒå¤§ï¼Œå› æ­¤æˆ‘ä»¬å°†å…¶å•ä½åŒ–ï¼Œå³<code>dx</code>å’Œ<code>dy</code>åˆ†åˆ«é™¤ä»¥å®ƒä»¬çš„æ¬§å¼è·ç¦»ã€‚å› æ­¤æ›´æ–°æˆ‘ä»¬çš„<code>gradient</code>å‡½æ•°å¦‚ä¸‹ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gradient</span>(c, points):
    <span style="color:#e6db74">&#39;&#39;&#39;
</span><span style="color:#e6db74">    params:
</span><span style="color:#e6db74">      c: (x,y) è¡¨ç¤ºå¾…æ±‚çš„è´¨å¿ƒåæ ‡
</span><span style="color:#e6db74">      points: æ‰€æœ‰çš„ç‚¹
</span><span style="color:#e6db74">    return:
</span><span style="color:#e6db74">      (dx, dy), åœ¨cç‚¹æ—¶coståœ¨ä¸¤ä¸ªç»´åº¦æ–¹å‘çš„æ¢¯åº¦
</span><span style="color:#e6db74">    &#39;&#39;&#39;</span>
    x <span style="color:#f92672">=</span> points[:, <span style="color:#ae81ff">0</span>]
    y <span style="color:#f92672">=</span> points[:, <span style="color:#ae81ff">1</span>]
    dist <span style="color:#f92672">=</span> sum((c <span style="color:#f92672">-</span> points) <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span>, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">**</span> <span style="color:#ae81ff">0.5</span>
    dx <span style="color:#f92672">=</span> sum((c[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> x) <span style="color:#f92672">/</span> dist)  <span style="color:#75715e">#æ±‚xåå¯¼æ•°</span>
    dy <span style="color:#f92672">=</span> sum((c[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> y) <span style="color:#f92672">/</span> dist)  <span style="color:#75715e">#æ±‚yåå¯¼æ•°</span>
    s <span style="color:#f92672">=</span> (dx <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> dy <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">**</span> <span style="color:#ae81ff">0.5</span> <span style="color:#75715e"># æ¬§å¼è·ç¦»</span>
    dx <span style="color:#f92672">=</span> dx<span style="color:#f92672">/</span>s
    dy <span style="color:#f92672">=</span> dy<span style="color:#f92672">/</span>s
    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>asarray([dx, dy])</code></pre></div>
<p>è¿è¡Œç»“æœç»˜å›¾ã€‚<br />
<div align=center>
<img src="/images/gd_good.png" width="60%" alt="GradientDescent">
</div></p>

<p>å›¾ä¸­çº¢è‰²çš„ç‚¹(ç”±äºæ¯”è¾ƒå¯†é›†ï¼Œçœ‹èµ·æ¥åƒçº¿)ï¼Œè¡¨ç¤ºè·¯å¾„ä¸Šçš„ç‚¹ï¼Œåœ¨ç¨³æ­¥å‘ä¸­å¿ƒé æ‹¢ï¼Œæœ€ç»ˆå¾—åˆ°çš„è´¨å¿ƒä¹Ÿæ¥è¿‘ç†æƒ³çš„è´¨å¿ƒã€‚è‡³æ­¤ï¼Œå®Œæˆæœ¬éƒ¨åˆ†å®éªŒã€‚</p>

<h4 id="q4">Q4</h4>

<p><strong>Apply stochastic gradient descent (SGD) to find the centroid. Can you say in simple words, what the algorithm is doing?</strong></p>

<p>éšæœºæ¢¯åº¦ä¸‹é™å’Œæ¢¯åº¦ä¸‹é™çš„åŒºåˆ«ï¼š<br />
1. æ¢¯åº¦ä¸‹é™éœ€è¦æ‰€æœ‰ç‚¹éƒ½å‚ä¸æ¢¯åº¦æ›´æ–°ï¼›éšæœºæ¢¯åº¦ä¸‹é™æ˜¯æ¯æ¬¡è¿­ä»£æ—¶ï¼Œéšæœºé€‰å–ä¸€ä¸ªç‚¹è®¡ç®—æ¢¯åº¦ã€‚<br />
2. æ¢¯åº¦ä¸‹é™æœ€ç»ˆçš„ç»“æœæ˜¯ä¸€èˆ¬æ˜¯ç¨³å®šçš„ï¼Œå³ç¨³å®šæ”¶æ•›åˆ°æŸä¸ªç‚¹ï¼›éšæœºæ¢¯åº¦ä¸‹é™å¯èƒ½ä¼šé™·å…¥æŸä¸ªå±€éƒ¨æœ€å°å€¼ã€‚</p>

<p>ä¿®æ”¹<code>gradient</code>å‚æ•°ï¼Œä½¿å¾—è¿­ä»£æ—¶éšæœºé€‰å–ä¸€ä¸ªç‚¹ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">stochasticgradient</span>(c, points):
    <span style="color:#e6db74">&#39;&#39;&#39;
</span><span style="color:#e6db74">    params:
</span><span style="color:#e6db74">      c: (x,y) è¡¨ç¤ºå¾…æ±‚çš„è´¨å¿ƒåæ ‡
</span><span style="color:#e6db74">      points: æ‰€æœ‰çš„ç‚¹
</span><span style="color:#e6db74">    return:
</span><span style="color:#e6db74">      (dx, dy), åœ¨cç‚¹æ—¶coståœ¨ä¸¤ä¸ªç»´åº¦æ–¹å‘çš„æ¢¯åº¦
</span><span style="color:#e6db74">    &#39;&#39;&#39;</span>
    r <span style="color:#f92672">=</span> choice(points)
    dx <span style="color:#f92672">=</span> (c[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> r[<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">/</span> sum((c <span style="color:#f92672">-</span> r) <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">**</span> <span style="color:#ae81ff">0.5</span> <span style="color:#75715e"># xåå¯¼</span>
    dy <span style="color:#f92672">=</span> (c[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> r[<span style="color:#ae81ff">1</span>]) <span style="color:#f92672">/</span> sum((c <span style="color:#f92672">-</span> r) <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">**</span> <span style="color:#ae81ff">0.5</span>  <span style="color:#75715e"># yåå¯¼</span>
    s <span style="color:#f92672">=</span> (dx <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> dy <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">**</span> <span style="color:#ae81ff">0.5</span>
    dx <span style="color:#f92672">=</span> dx<span style="color:#f92672">/</span>s
    dy <span style="color:#f92672">=</span> dy<span style="color:#f92672">/</span>s
    <span style="color:#66d9ef">return</span> array([dx, dy])</code></pre></div>
<p>æˆ‘ä»¬ä¿®æ”¹<code>gradientDescent</code>å‡½æ•°ï¼Œåœ¨è®¡ç®—æ¢¯åº¦çš„æ—¶å€™è°ƒç”¨<code>stochasticgradient</code>æ–¹æ³•ï¼Œè¿™æ ·æˆ‘ä»¬æŠŠè®¡ç®—æ¢¯åº¦æ‰€ç”¨çš„å‡½æ•°ä½œä¸ºä¸€ä¸ªå‚æ•°ï¼ŒåŒæ ·ä¼ é€’è¿›å»ã€‚ä¿®æ”¹åä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gd_final</span>(points, gd_method<span style="color:#f92672">=</span>gradient,start<span style="color:#f92672">=</span>array([<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>]), theta<span style="color:#f92672">=</span><span style="color:#ae81ff">0.01</span>, iterations<span style="color:#f92672">=</span><span style="color:#ae81ff">500</span>, eps<span style="color:#f92672">=</span><span style="color:#ae81ff">1e-6</span>, lr_decay<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>):
    <span style="color:#e6db74">&#39;&#39;&#39;
</span><span style="color:#e6db74">    params:
</span><span style="color:#e6db74">      gd_method: è¿­ä»£çš„æ–¹å¼ï¼Œå¯ä»¥åœ¨(stochasticgradient, gradient)ä¸­é€‰æ‹©
</span><span style="color:#e6db74">      start: åˆå§‹åŒ–ç‚¹ï¼Œå³å‡ºå‘ç‚¹ï¼Œä¸ºäº†ä¾¿äºè§‚å¯Ÿï¼Œå¯ä»¥è®¾ç½®ä¸ºå››ä¸ªé¡¶ç‚¹ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œè¿™é‡Œé»˜è®¤ä¸ºå³ä¸Šè§’çš„é¡¶ç‚¹
</span><span style="color:#e6db74">      points: æ‰€æœ‰é‡‡æ ·ç‚¹
</span><span style="color:#e6db74">      theta: æ­¥é•¿ï¼Œå³å­¦ä¹ ç‡ï¼Œæ§åˆ¶æ­¥é•¿
</span><span style="color:#e6db74">      iterations: è¿­ä»£æ¬¡æ•°
</span><span style="color:#e6db74">      eps: é˜ˆå€¼ï¼Œé€šè¿‡æ¯”è¾ƒå‰åè¿ç»­ä¸¤æ¬¡çš„costå·®å€¼æ§åˆ¶å¾ªç¯ç»“æŸã€‚
</span><span style="color:#e6db74">    return:
</span><span style="color:#e6db74">      x_route: centroidè·¯å¾„
</span><span style="color:#e6db74">      x: æ”¶æ•›æ—¶çš„centroid
</span><span style="color:#e6db74">      i: end iteration, é€€å‡ºè¿­ä»£æ—¶å·²ç»è¿­ä»£äº†å¤šå°‘æ¬¡
</span><span style="color:#e6db74">    &#39;&#39;&#39;</span>
    x <span style="color:#f92672">=</span> start
    x_route <span style="color:#f92672">=</span> x
    pre_cost <span style="color:#f92672">=</span> cost(x, points) <span style="color:#75715e"># åˆå§‹cost</span>
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(iterations):
        grad <span style="color:#f92672">=</span> gd_method(x, points)
        x_i <span style="color:#f92672">=</span> x <span style="color:#f92672">-</span> theta <span style="color:#f92672">*</span> grad
        cur_cost <span style="color:#f92672">=</span> cost(x_i, points)
        <span style="color:#66d9ef">if</span> pre_cost <span style="color:#f92672">-</span> cur_cost <span style="color:#f92672">&gt;</span> eps: <span style="color:#75715e"># å‰ä¸€ä¸ªcostä¸å½“å‰costçš„å·®å¤§äºé˜ˆå€¼ï¼Œå¯ä»¥ç»§ç»­è¿­ä»£</span>
            x <span style="color:#f92672">=</span> x_i
            pre_cost <span style="color:#f92672">=</span> cur_cost
        <span style="color:#66d9ef">elif</span> cur_cost <span style="color:#f92672">-</span> pre_cost <span style="color:#f92672">&gt;</span> eps: <span style="color:#75715e"># è¿™ä¸€æ­¥â€œè·¨â€çš„è¿‡å¤§ï¼Œè°ƒå°æ­¥é•¿</span>
            theta <span style="color:#f92672">=</span> theta <span style="color:#f92672">*</span> lr_decay
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">return</span> x_route, x, i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>
        x_route <span style="color:#f92672">=</span> vstack((x_route, x))
    <span style="color:#66d9ef">return</span> x_route, x, i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span></code></pre></div>
<p>æœ€ç»ˆå¾—åˆ°ä¸‹å›¾ï¼š<br />
<div align=center>
<img src="/images/sgd_good.png" width="60%" alt="SGD">
</div></p>

<p>è¿™å¼ å›¾æ˜¯åœ¨å¤šæ¬¡è°ƒæ•´å‚æ•°å¤šæ¬¡è¿è¡Œä¹‹åå¾—åˆ°ç»“æœç›¸å¯¹è¾ƒå¥½çš„å›¾ã€‚ ä¸‹é¢ä¸¤å¼ åˆ™æ˜¯é™·å…¥å±€éƒ¨æœ€å°æ—¶çš„æƒ…å†µã€‚<br />
<div align=center>
<img src="/images/sgd_rand.png" width="60%" alt="SGD_rand">
</div></p>

<p>å¯ä»¥çœ‹åˆ°ï¼Œç”±äºæ˜¯éšæœºé€‰å–çš„ç‚¹ï¼Œæ‰€ä»¥åœ¨æ‰¾æœ€ä¼˜å€¼çš„è¿‡ç¨‹æ˜¯æ›²æŠ˜çš„ã€‚ä½†æ˜¯æœ€ç»ˆè¿˜æ˜¯ä¼šæ”¶æ•›ã€‚</p>
                        </div>
                    </div>
                    
                    <div class="post-tags">
                        <span># Tags: </span>
                            
                                <a class="badge badge-primary" href="/tags/machine-learning">Machine Learning</a>
                            
                                <a class="badge badge-primary" href="/tags/code">Code</a>
                            
                    </div>
                    
                    <nav class="post-related">
                            

    <a rel="prev" id="prev-btn" class="btn hvr-grow" href="/posts/argmax-function-and-its-usage/"> &laquo; axis and argmax function</a>


    <a rel="next" id="next-btn" class="btn hvr-grow" href="/posts/%E4%BD%A0%E4%B9%9F%E6%83%B3%E8%A6%81%E9%87%8D%E6%9D%A5%E5%90%97/">ä½ ä¹Ÿæƒ³è¦é‡æ¥å— &raquo;</a>


                    </nav>
                    <footer class="comments">
                        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "xfeif" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                    </footer>
                </div>
            </div>

        </article>
    </div>
    <a id="rocket" href="#top" class=""></a>
<script type="text/javascript" src="https://blog.x-fei.me/js/totop.js"></script>
<footer id="footer" class='site-footer'>
    
    <section class="footer">
    
       ğŸ“<a href="https://blog.x-fei.me">XFeiF</a> Â© 2015-2021 <i class="fa fa-heart" aria-hidden="true"></i>
    
    </section>
    <section>
        Theme Fx <a href="https://github.com/XFeiF" class="github-repo"><span class="gadget-github"></span>Star</a>
        Designed By <a href="https://github.com/XFeiF">@XFeiF</a>
    </section>
    <section class="poweredby">
        Powered by <a href="http://www.gohugo.io/">Hugo</a>
    </section>
</footer>

</body>
</html>
